function ArrayFilter(f, receiver) {
  CHECK_OBJECT_COERCIBLE(this, "Array.prototype.filter");
  // Pull out the length so that modifications to the length in the
  // loop will not affect the looping and side effects are visible.
  var array = TO_OBJECT(this);
  var length = TO_LENGTH_OR_UINT32(array.length);
  var accumulator = InnerArrayFilter(f, receiver, array, length);
  var result = new GlobalArray();
  %MoveArrayContents(accumulator, result);
  return result;
}